@using Blazored.LocalStorage
@using SSDI.RequestMonitoring.UI.Services

@inject ILocalStorageService localStorage

<div class="general-settings">
    <div class="settings-section">
        <h4>General Settings</h4>

        @* <div class="settings-item">
            <div class="settings-item__label">
                <label for="language">Language</label>
                <span class="settings-hint">Choose your preferred language</span>
            </div>
            <select id="language" class="form-select" @bind="language" @bind:after="SaveLanguage">
                <option value="en">English</option>
                <option value="es">Español</option>
                <option value="fr">Français</option>
                <option value="de">Deutsch</option>
            </select>
        </div>

        <div class="settings-item">
            <div class="settings-item__label">
                <label for="timezone">Time Zone</label>
                <span class="settings-hint">Set your local time zone</span>
            </div>
            <select id="timezone" class="form-select" @bind="timezone" @bind:after="SaveTimezone">
                <option value="UTC">UTC (Coordinated Universal Time)</option>
                <option value="EST">Eastern Standard Time (EST)</option>
                <option value="CST">Central Standard Time (CST)</option>
                <option value="MST">Mountain Standard Time (MST)</option>
                <option value="PST">Pacific Standard Time (PST)</option>
            </select>
        </div>

        <div class="settings-item">
            <div class="settings-item__label">
                <label>Theme</label>
                <span class="settings-hint">Choose your preferred theme</span>
            </div>
            <div class="theme-selector">
                <button class="theme-option @(theme == "light" ? "active" : "")"
                        @onclick="@(() => ChangeTheme("light"))">
                    <i class="bi bi-sun"></i>
                    <span>Light</span>
                </button>
                <button class="theme-option @(theme == "system" ? "active" : "")"
                        @onclick="@(() => ChangeTheme("system"))">
                    <i class="bi bi-laptop"></i>
                    <span>System</span>
                </button>
            </div>
        </div> *@
    </div>
</div>

@code {
    private string language = "en";
    private string timezone = "UTC";
    private string theme = "light";
    // private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        await LoadSettings();
        // isLoading = false;
    }

    private async Task LoadSettings()
    {
        try
        {
            language = await localStorage.GetItemAsync<string>("language") ?? "en";
            timezone = await localStorage.GetItemAsync<string>("timezone") ?? "UTC";
            theme = await localStorage.GetItemAsync<string>("theme") ?? "light";
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading settings: {ex.Message}");
        }
    }

    private async Task SaveLanguage()
    {
        await localStorage.SetItemAsync("language", language);
        toastSvc.ShowSuccess("Language saved successfully!");
    }

    private async Task SaveTimezone()
    {
        await localStorage.SetItemAsync("timezone", timezone);
        toastSvc.ShowSuccess("Time zone saved successfully!");
    }

    private async Task ChangeTheme(string newTheme)
    {
        theme = newTheme;
        await localStorage.SetItemAsync("theme", theme);
        toastSvc.ShowSuccess($"Theme changed to {newTheme}!");
    }
}