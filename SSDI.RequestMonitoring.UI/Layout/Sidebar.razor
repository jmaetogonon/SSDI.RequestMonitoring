@inject IJSRuntime JS
@inject NavigationManager NavigationManager

<div class="sidebar">
    <button class="sidebar__toggle-btn" @onclick="ToggleSidebar">
        <i class="bi bi-list"></i>
    </button>

    <div class="sidebar__links @(isSidebarOpen ? "sidebar__links--open" : "sidebar__links--closed")">
        <div class="sidebar__section">
            <div class="sidebar__section-title" style="margin-top: 0.5rem !important;">General</div>
            <a href="/dashboard" class="sidebar__link @GetNavLinkClass("/dashboard")" @onclick="ToggleSidebarIfMobile" >
                <i class="bi bi-house-door-fill sidebar__icon" /> <span>Dashboard</span>
            </a>
            <a href="/requests/purchase-requests" class="sidebar__link @GetNavLinkClass("/requests/purchase-requests")" @onclick="ToggleSidebarIfMobile">
                <i class="bi bi-bag-fill sidebar__icon" /> <span>Purchase Requests</span>
            </a>
            <a href="/requests/job-orders" class="sidebar__link @GetNavLinkClass("/requests/job-orders")" @onclick="ToggleSidebarIfMobile">
                <i class="bi bi-wrench-adjustable sidebar__icon" /> <span>Job Orders</span>
            </a>


            <!-- Settings Section with Submenu -->
           @*  <div class="sidebar__section-title">Settings</div>
            <button class="sidebar__link sidebar__link--settings" @onclick="ToggleSettingsMenu">
                <i class="bi bi-gear-fill sidebar__icon"></i> <span>Settings</span> <i class="bi bi-chevron-right"></i>
            </button>
            <div class="sidebar__submenu @(isSettingsMenuOpen ? "sidebar__submenu--open" : "sidebar__submenu--closed")">
                <a href="/settings/users" class="sidebar__submenu-link @(GetNavLinkClass("/settings/users"))">
                    <i class="bi bi-people-fill"></i>
                    <span>User Management</span>
                </a>
                <a href="/settings/roles" class="sidebar__submenu-link @(GetNavLinkClass("/settings/roles"))">
                    <i class="bi bi-shield-check"></i>
                    <span>Role Management</span>
                </a>
            </div> *@
        </div>
    </div>
</div>


@if (isSidebarOpen)
{
    <div class="sidebar__overlay" @onclick="ToggleSidebar"></div>
}
@code {

    private bool isSidebarOpen = false;
    private bool isSettingsMenuOpen = false;
    private bool initialized = false;

    private void ToggleSidebar() => isSidebarOpen = !isSidebarOpen;
    private void ToggleSettingsMenu() => isSettingsMenuOpen = !isSettingsMenuOpen;

    private async Task ToggleSidebarIfMobile()
    {
        var isMobile = await JS.InvokeAsync<int>("eval", "window.innerWidth") <= 600;

        if (isMobile)
        {
            isSidebarOpen = false;
            StateHasChanged();
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && !initialized)
        {
            initialized = true;
            var width = await JS.InvokeAsync<int>("eval", "window.innerWidth");
            isSidebarOpen = width > 600;
            StateHasChanged();
        }
    }

    private string GetNavLinkClass(string path)
    {
        return NavigationManager.Uri.EndsWith(path) ? "active" : "";

    }
}
