@page "/system-configuration/users"
@using SSDI.RequestMonitoring.UI.Contracts.Users
@using SSDI.RequestMonitoring.UI.JComponents.Controls
@using SSDI.RequestMonitoring.UI.JComponents.Modals
@using SSDI.RequestMonitoring.UI.Models.MasterData
@attribute [Authorize(Roles = TokenCons.Role__Admin)]
@inject IUserSvc userSvc

<PageTitle>Users</PageTitle>

<Confirmation__Modal @ref="_confirmModal" />

<div class="main--content">
    <BreadcrumbNav IsNoPadding="true">
        <BreadcrumbItem Label="System Configuration" Href="/system-configuration" />
        <BreadcrumbItem Label="Users" IsCurrent="true" />
    </BreadcrumbNav>

    <FluentMessageBarProvider Section="USERSC" ClearAfterNavigation=true MaxMessageCount="1" />

    <div class="sysconfig-page__header">
        <div class="sysconfig-page__title-section">
            <p class="sysconfig-page__header-title">Users</p>
            <p class="sysconfig-page__header-subtitle">Manage organizational users</p>
        </div>

        <div class="sysconfig-page__header-cta">
            <button class="btn btn--secondary" @onclick="OnCancel">
                <i class="bi bi-x-lg"></i> Cancel
            </button>
            <button class="btn btn--primary" @onclick="OnSync">
                <i class="bi bi-arrow-repeat"></i> Sync
            </button>
        </div>
    </div>

    <!-- Filter Bar -->
    <div class="sysconfig-filter-container">
        <FluentSearch @bind-Value="@_searchValue"
                      @bind-Value:after="HandleSearch"
                      Immediate="true"
                      Placeholder="Search"
                      Class="page__filters-search" />
    </div>

    <div class="sysconfig-page__main__section">
        <div class="sysconfig__table-container">
            @if (_allItems == null)
            {
                <div class="sysconfig-loading">
                    <div class="loading-spinner"></div>
                    <p>Loading users...</p>
                </div>
            }
            else if (_allItems.Count == 0)
            {
                <div class="sysconfig-empty">
                    <i class="bi bi-building"></i>
                    <h3>No User Found</h3>
                    <p>Start by adding syncing business units from server</p>
                    <button class="btn btn--primary" @onclick="OnSync">
                        <i class="bi bi-arrow-repeat"></i> Sync
                    </button>
                </div>
            }
            else if (_filteredItems.Count == 0)
            {
                <div class="sysconfig-empty">
                    <i class="bi bi-search"></i>
                    <h3>No Results Found</h3>
                    <p>No divisions match your search "<strong>@_searchValue</strong>"</p>
                    <button class="btn btn--ghost" @onclick="ClearSearch">
                        <i class="bi bi-x-lg"></i> Clear Search
                    </button>
                </div>
            }
            else
            {
                <div class="sysconfig-table">
                    <!-- Table Header -->
                    <div class="sysconfig-table-header">
                        <div class="sysconfig-table-row header-row">
                            <div class="sysconfig-table-cell header-cell" style="flex: 0 0 60px;">#</div>
                            <div class="sysconfig-table-cell header-cell" style="flex: 0 0 222px;">Name</div>
                            <div class="sysconfig-table-cell header-cell" style="flex: 0 0 222px;">Username</div>
                            <div class="sysconfig-table-cell header-cell" style="flex: 1;">Role</div>
                            <div class="sysconfig-table-cell header-cell" style="flex: 1;">Dept Head</div>
                            <div class="sysconfig-table-cell header-cell" style="flex: 1;">Div Head</div>
                        </div>
                    </div>

                    <!-- Table Body -->
                    <div class="sysconfig-table-body" id="divisionTableBody">
                        @{
                            var displayIndex = 1;
                        }
                        @foreach (var bu in _filteredItems)
                        {
                            var isNew = bu.Id == 0;
                            <div class="sysconfig-table-row data-row @(isNew ? "new-item" : "")" key="@bu.Id">
                                <div class="sysconfig-table-cell" style="flex: 0 0 60px;" data-label="#">
                                    <span class="row-number">@(displayIndex++)</span>
                                </div>
                                <div class="sysconfig-table-cell" data-label="Name">
                                    <div class="input-wrapper">
                                        <input type="text" readonly
                                               class="table-text-input"
                                               @bind="bu.FullName" />
                                    </div>
                                </div>
                                <div class="sysconfig-table-cell" data-label="Username">
                                    <div class="input-wrapper">
                                        <input type="text" readonly
                                               class="table-text-input"
                                               @bind="bu.Username" />
                                    </div>
                                </div>
                                <div class="sysconfig-table-cell" style="flex: 1;" data-label="Role">
                                    <div class="input-wrapper">
                                        <input type="text" readonly
                                               class="table-text-input"
                                               @bind="bu.RoleDesc" />
                                    </div>
                                </div>
                                <div class="sysconfig-table-cell" style="flex: 1;" data-label="Dept Head">
                                    <div class="input-wrapper">
                                        <input type="text" readonly
                                               class="table-text-input"
                                               @bind="bu.DepartmentHeadName" />
                                    </div>
                                </div>
                                <div class="sysconfig-table-cell" style="flex: 1;" data-label="Div Head">
                                    <div class="input-wrapper">
                                        <input type="text" readonly
                                               class="table-text-input"
                                               @bind="bu.DivisionHeadName" />
                                    </div>
                                </div> 
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
    </div>
</div> 